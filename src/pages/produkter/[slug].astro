---
import Mainlayout from '../../layouts/Mainlayout.astro';
import Knapper from '../../components/Knapper.astro';
import Andre from '../../components/andre.astro';

export async function getStaticPaths() {
  const produkter = await fetch("https://aoxvweiitrgqnzrjdlqp.supabase.co/rest/v1/Pyoma_shop", {
    headers: {
      apikey: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFveHZ3ZWlpdHJncW56cmpkbHFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzM3NDM2NzIsImV4cCI6MjA0OTMxOTY3Mn0.4iCL7wkdvdNR-GKHMGyPkWsPs9SQYD2iEXIX-JkxOA4",
    },
  }).then((res) => res.json());

return produkter.map((produkt) =>{
  return{  
    params: { slug: produkt.slug },
    props: { produkt }, 
  };
});
}

const { produkt } = Astro.props;

// Her hentes de andre produkter der hører til produktets outfit //
const andre = await fetch(`https://aoxvweiitrgqnzrjdlqp.supabase.co/rest/v1/Pyoma_shop?outfit_nummer=eq.${produkt.outfit_nummer}`, {
  method:"GET",
  headers: {
    apikey: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFveHZ3ZWlpdHJncW56cmpkbHFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzM3NDM2NzIsImV4cCI6MjA0OTMxOTY3Mn0.4iCL7wkdvdNR-GKHMGyPkWsPs9SQYD2iEXIX-JkxOA4",
  },
}).then((res) => res.json());

console.log(andre);
---

<Mainlayout>
<div class="single_view">
<div class="img_container">
  <div class="slides">
    <div class="slide">
      <img class="img" src=`../../../outfits/${produkt.produkt_image}` alt={produkt.produkt_navn}></img>
    </div>
    <div class="slide">
      <img class="img" src=`../../../outfits/${produkt.produkt_imagehover}` alt={produkt.produkt_navn}></img> 
    </div>
    <div class="slide">
       <img class="img" src=`../../../outfits/${produkt.singleview_image}` alt={produkt.produkt_navn}></img> 
    </div>
  </div>
  <!-- Navigation knapper -->
  <button class="prev">&#10094;</button> <!-- Pil til venstre -->
  <button class="next">&#10095;</button> <!-- Pil til højre -->
</div>
<div>
<h1>{produkt.produkt_navn}</h1>
     <p>Størrelse (EUR) – {produkt.produkt_str}</p>
     <a class="infotekst" href="/om_pyoma#strguide">STØRRELSESGUIDE</a>
     <p>Stand på produktet – {produkt.produkt_stand}</p>
     <a class="infotekst" href="/om_pyoma#standguide">STANDGUIDE</a>
  <br>
     <div>
    <button class="fold_ud_knap">Beskrivelse <span class="plus">+</span></button>
    <div class="fold_ud_tekst">
        <p>{produkt.produkt_beskrivelse}</p>
    </div>
    </div>
    <hr>
    <div class="fold_ud">
    <button class="fold_ud_knap">Materiale & vask <span class="plus">+</span></button>
    <div class="fold_ud_tekst">
        <p>{produkt.produkt_materiale}</p>
        <p>{produkt.produkt_vaskeanvisninger}</p>
    </div>
    </div>
    <hr>
    <h2>{produkt.produkt_pris} DKK</h2>
    <p class="infotekst kursiv">Levering beregnes ved betaling</p>
    <Knapper variant="primary">KØB</Knapper>

    <p class="bold">Køb hele outfitet</p>
    {
    andre.map((andre) => (
      <Andre andre={andre} />
    ))
  }
  </div>
  </div>
</Mainlayout>



<style>
/* Grundopsætning */
.single_view{
  margin-inline: var(--mobile-40);
}
img{
  aspect-ratio: 1/2;
  object-fit: cover;
}
.img_container {
  position: relative;
  overflow: hidden;
}

/* Slideshow styling */
.slides {
  display: flex;
  transition: transform 0.5s ease-in-out;
  width: 100%;
}

.slide {
  flex: 0 0 100%; /* Hvert billede fylder hele containerens bredde */
  text-align: center;
}

/* Navigation knapper */
.img_container button {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  color: var(--mahogany-red);
  border: none;
  font-size: 2rem;
  padding: 5px 10px;
  cursor: pointer;
  z-index: 10;
}

button.prev {
  left: 10px; /* Pil til venstre */
}

button.next {
  right: 10px; /* Pil til højre */
}

h1, p{
  padding-top: var(--mobile-20);
}
   a {
    text-decoration: underline;
   }

   button {
    cursor: pointer;
    background-color: #ffffff00;  
    border: none;

    color: var(--mahogany-red);
    font-family: "minion_proregular";
    font-size: 16px;
   }

   button:hover {
    font-family: "minion_proregular";
    font-weight: 900;
    font-size: 16px;
   }

   .fold_ud {
    display: flex;
    align-items: Stretch;
   }
   .fold_ud_tekst {
    display: none; /* Skjul tekstcontainer som standard */
}

/* Desktop styling */
@media (min-width: 769px) {
  .single_view{
    display: grid;
    grid-template-columns: 2fr 1fr;
  }
  .img_container {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* Tre kolonner */
    height: auto; /* Tilpas højde */
  }

  .slides {
    display: contents; /* Fjern flex-layout for slides */
    transform: none;
  }

  button {
    display: none; /* Skjul knapper på desktop */
  }
}

/* Måske disse to klasser skal flyttes i generelt css? */
.kursiv {
  font-style: italic;
  }
  .bold {
    font-weight: 999;
  }
</style>

<script>
document.querySelectorAll(".fold_ud_knap").forEach(function (knap) {
    knap.addEventListener("click", function () {
        let content = knap.nextElementSibling; // Find den tilhørende tekstcontainer

        if (content.style.display === "none" || content.style.display === "") {
            knap.textContent = "-"; // Skift tekst
            content.style.display = "block"; // Vis teksten
        } else {
            knap.textContent = "+"; // Skift tekst
            content.style.display = "none"; // Skjul teksten
        }
    });
});

const slides = document.querySelector('.slides');
const nextButton = document.querySelector('.next');
const prevButton = document.querySelector('.prev');

let currentSlide = 0; // Start på første slide
const totalSlides = document.querySelectorAll('.slide').length;

function updateSlide() {
  const slideWidth = document.querySelector('.slide').clientWidth;
  slides.style.transform = `translateX(-${currentSlide * slideWidth}px)`;
}

nextButton.addEventListener('click', () => {
  currentSlide = (currentSlide + 1) % totalSlides; // Loop tilbage til første slide
  updateSlide();
});

prevButton.addEventListener('click', () => {
  currentSlide = (currentSlide - 1 + totalSlides) % totalSlides; // Loop til sidste slide
  updateSlide();
});

</script>

